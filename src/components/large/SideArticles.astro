---
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
import { IoChevronBack, IoChevronForward } from "solid-icons/io";

interface Props {
	slug: CollectionEntry<"article">["slug"];
}

const { slug } = Astro.props;

const articles = await getCollection("article", ({ data }) => {
	return import.meta.env.PROD ? data.isDraft === false : true;
});

const getSideArticles = async (
	articles: CollectionEntry<"article">[],
	slug: CollectionEntry<"article">["slug"]
): Promise<{
	prev: CollectionEntry<"article"> | undefined;
	next: CollectionEntry<"article"> | undefined;
}> => {
	const notedArticleIdx = articles.map((article) => article.slug).indexOf(slug);

	const prev = articles[notedArticleIdx - 1];
	const next = articles[notedArticleIdx + 1];

	return {
		prev,
		next,
	};
};

const { prev, next } = await getSideArticles(articles, slug);
---

<ul class="flex flex-col lg:flex-row justify-between items-center gap-4 lg:gap-8">
	<li
		class={`w-full lg:w-[calc(50%-1rem)] h-20 border ${prev ? "border-muted-background hover:bg-muted-background" : "border-background"} transition-colors duration-150 rounded-xl`}
	>
		{
			prev && (
				<a href={`/blog/articles/${prev.slug}`}>
					<div class="relative flex justify-between items-center gap-2">
						<div class="relative w-[1.6rem] h-20">
							<IoChevronBack class="absolute left-1 top-1/2 -translate-y-1/2 text-2xl" />
						</div>
						<div class="px-1 font-semibold">{prev.data.title}</div>
					</div>
				</a>
			)
		}
	</li>
	<li
		class={`w-full lg:w-[calc(50%-1rem)] h-20 border ${next ? "border-muted-background hover:bg-muted-background" : "border-background"} transition-colors duration-150 rounded-xl`}
	>
		{
			next && (
				<a href={`/blog/articles/${next.slug}`}>
					<div class="relative flex justify-between items-center gap-2">
						<div class="px-1 font-semibold">{next.data.title}</div>
						<div class="relative w-[1.6rem] h-20">
							<IoChevronForward class="absolute right-1 top-1/2 -translate-y-1/2 text-2xl" />
						</div>
					</div>
				</a>
			)
		}
	</li>
</ul>
